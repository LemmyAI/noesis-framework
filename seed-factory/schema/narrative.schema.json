{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "NOESIS Narrative Seed",
  "description": "Schema for NOESIS seed factory YAML files",
  "type": "object",
  "required": ["seed", "entities"],
  "properties": {
    "seed": {
      "type": "object",
      "required": ["name", "namespace"],
      "properties": {
        "name": {
          "type": "string",
          "pattern": "^[a-z0-9][a-z0-9-]*$",
          "description": "Seed identifier (kebab-case, used as filename)"
        },
        "label": {
          "type": "string",
          "description": "Human-readable title"
        },
        "namespace": {
          "type": "string",
          "description": "Target namespace (e.g. history.civil-war)"
        },
        "description": {
          "type": "string",
          "description": "One-line description of the seed"
        }
      }
    },
    "namespace_chain": {
      "type": "array",
      "description": "Namespace hierarchy from root to leaf. Omit if using only default types.",
      "items": {
        "type": "object",
        "required": ["namespace", "extends"],
        "properties": {
          "namespace": { "type": "string" },
          "extends": { "type": "string" },
          "added_types": {
            "type": "object",
            "additionalProperties": {
              "type": "object",
              "required": ["parent"],
              "properties": {
                "parent": { "type": "string" },
                "color": { "type": "string", "pattern": "^#[0-9A-Fa-f]{6}$" }
              }
            }
          }
        }
      }
    },
    "entities": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["id", "type", "name", "category"],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^[a-z0-9][a-z0-9._-]*$",
            "description": "Unique entity ID (kebab-case)"
          },
          "type": {
            "type": "string",
            "description": "Entity type (must exist in namespace chain or defaults)"
          },
          "name": {
            "type": "string",
            "maxLength": 200,
            "description": "Human-readable display name"
          },
          "key": {
            "type": "string",
            "description": "Optional cross-namespace identity (e.g. PERSON:NAPOLEON)"
          },
          "namespace": {
            "type": "string",
            "description": "Override namespace for this entity (defaults to seed.namespace)"
          },
          "category": {
            "type": "string",
            "description": "Required UI grouping category (e.g. people.commanders)"
          },
          "description": {
            "type": "string",
            "maxLength": 500
          },
          "confidence": {
            "type": "string",
            "enum": ["verified", "high", "medium", "low", "disputed"],
            "default": "medium"
          },
          "sources_count": {
            "type": "integer",
            "minimum": 0
          },
          "confidence_note": {
            "type": "string",
            "description": "Note on credibility (e.g. 'Debated among historians')"
          },
          "temporal": {
            "oneOf": [
              { "type": "string", "description": "ISO date string (auto-detects precision)" },
              {
                "type": "object",
                "properties": {
                  "start": { "type": "string" },
                  "end": { "type": "string" },
                  "precision": {
                    "type": "string",
                    "enum": ["second", "minute", "hour", "day", "month", "year"]
                  }
                },
                "required": ["start"]
              }
            ]
          }
        },
        "additionalProperties": true
      }
    },
    "relations": {
      "type": "array",
      "description": "Structural (non-narrative) relations",
      "items": {
        "type": "object",
        "required": ["from", "to", "type"],
        "properties": {
          "from": { "type": "string" },
          "to": { "type": "string" },
          "type": {
            "type": "string",
            "enum": ["causes", "enables", "prevents", "part_of", "follows", "depends_on", "contradicts", "supports"]
          },
          "description": { "type": "string" }
        }
      }
    },
    "narratives": {
      "type": "array",
      "description": "Named narrative chains (ordered story sequences)",
      "items": {
        "type": "object",
        "required": ["name", "steps"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Narrative display name (the 'context' field in DB)"
          },
          "steps": {
            "type": "array",
            "minItems": 1,
            "items": {
              "type": "object",
              "required": ["from", "to", "type"],
              "properties": {
                "from": { "type": "string" },
                "to": { "type": "string" },
                "type": {
                  "type": "string",
                  "enum": ["causes", "enables", "prevents", "part_of", "follows", "depends_on", "contradicts", "supports"]
                },
                "description": { "type": "string" }
              }
            }
          }
        }
      }
    },
    "sources": {
      "type": "array",
      "description": "Datalayer source evidence",
      "items": {
        "type": "object",
        "required": ["entity", "type"],
        "properties": {
          "entity": { "type": "string", "description": "Entity ID this source backs" },
          "type": {
            "type": "string",
            "enum": ["article", "report", "primary_source", "secondary_source", "encyclopedia", "specification", "reference", "interview", "dataset", "preservation"]
          },
          "title": { "type": "string" },
          "url": { "type": "string" },
          "excerpt": { "type": "string" },
          "source_name": { "type": "string" },
          "published": { "type": "string", "description": "Publication date (ISO format)" }
        }
      }
    }
  }
}
